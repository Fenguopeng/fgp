<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<link rel="stylesheet" type="text/css" href="/css/main.css?v="/>
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css" rel="stylesheet">
<title> png图片结构分析 | 时针它不停在转动 </title>
</head>
<body>
<div id="">
<header id="header" class="header"><div class="header_wrapper">
<h1 class="title">
<a href="/">时针它不停在转动</a>
</h1>

<ul class="nav">


<li>
<a href="/">首页</a>
</li>


<li>
<a href="/archives">归档</a>
</li>


<li>
<a href="/about">关于</a>
</li>

</ul>
</div>
</header>
<main id="main" class="main">
<section id="content" class="content ">

  <div id="posts" class="posts-expand">
    
<article class="post">
<header class="post-header">
<h1 class="post-title">

png图片结构分析
</a>

</h1>
<div class="post-meta">
<span class="post-time">2016-09-20</span>
<span class="post-category">

&nbsp; | &nbsp;
<a class="post-cat-link" href="/categories/CTF/">
CTF
</a>

</span>
</div>
</header>

<span class="articleBody"><h1 id="PNG文件结构分析"><a href="#PNG文件结构分析" class="headerlink" title="PNG文件结构分析"></a>PNG文件结构分析</h1><blockquote>
<p>便携式网络图形（Portable Network Graphocs，PNG）是一种无损压缩的<em>位图</em>图形格式，支持索引、灰度、RGB三种颜色方案以及Alpha通道等特性。本文着重分析文件结构。</p>
</blockquote>
<h2 id="文件结构"><a href="#文件结构" class="headerlink" title="文件结构"></a>文件结构</h2><p>PNG图像格式文件由一个8字节的PNG文件标识（file signature）域和3个以上的后续数据块（chunk）组成。一个有效的PNG图片必须包含一个IHDR、一个或多个IDAT、一个IEND。<br><a id="more"></a></p>
<h2 id="八字节文件标识域"><a href="#八字节文件标识域" class="headerlink" title="八字节文件标识域"></a>八字节文件标识域</h2><p>文件标识域：<code>89 50 4E 47 0D 0A 1A 0A</code></p>
<table>
<thead>
<tr>
<th>十六进制</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td>89</td>
<td>用于检测传输系统是否支持8位的字符编码，用以减少将文本文件被错误的识别成PNG文件机会</td>
</tr>
<tr>
<td>50 4E 47</td>
<td>PNG每个字母对应的ASCALL，让用户可以使用文本编辑器查看，识别出事PNG文件</td>
</tr>
<tr>
<td>0D 0A</td>
<td>DOS风格的换行符（CRLF）</td>
</tr>
<tr>
<td>1A</td>
<td>在DOS命令行下，用于阻止文件显示的文件结束符</td>
</tr>
<tr>
<td>0A</td>
<td>Unix风格的的换行符（LF）</td>
</tr>
</tbody>
</table>
<h2 id="数据块格式"><a href="#数据块格式" class="headerlink" title="数据块格式"></a>数据块格式</h2><p>PNG定义了两种类型的数据块，一种是PNG文件必须包含、读写软件也都必须支持的关键块，另一种是辅助块。这样可以保持向下兼容。<br>数据块结构如下：<br><strong>LENGTH</strong>+<strong>CHUNK TYPE</strong>+<strong>CHUNK DATA</strong>+<strong>CRC</strong> </p>
<table>
<thead>
<tr>
<th>域</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>length</td>
<td>4字节 只代表数据域长度</td>
</tr>
<tr>
<td>Chunk Type</td>
<td>4字节 块类型</td>
</tr>
<tr>
<td>Chunk Data</td>
<td>长度不固定，数据块数据</td>
</tr>
<tr>
<td>CRC</td>
<td>4字节 Chunk Type域和Chunk Data域的CRC校验值</td>
</tr>
</tbody>
</table>
<h2 id="关键数据块"><a href="#关键数据块" class="headerlink" title="关键数据块"></a>关键数据块</h2><p>PNG定义了两种类型的数据块，一种是PNG文件必须包含、读写软件也都必须支持的关键块，另一种是辅助块。这样可以保持向下兼容。</p>
<p>关键数据块中有四个标准数据块</p>
<table>
<thead>
<tr>
<th>标准数据块</th>
<th>出现次数</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td>文件头数据块IHDR</td>
<td>1</td>
<td>包含图像基本信息，作为第一个数据块出现并只出现一次</td>
</tr>
<tr>
<td>调色板数据块PLTE</td>
<td>1</td>
<td>必须放在图像数据块之前</td>
</tr>
<tr>
<td>图像数据块IDAT</td>
<td>N</td>
<td>存储实际图像数据。PNG数据允许包含的多个连续的图像数据块</td>
</tr>
<tr>
<td>图像结束数据块IEND</td>
<td>1</td>
<td>放在文件尾部，表示PNG数据流结束</td>
</tr>
</tbody>
</table>
<h3 id="文件头数据块IHDR"><a href="#文件头数据块IHDR" class="headerlink" title="文件头数据块IHDR"></a>文件头数据块IHDR</h3><p>IHDR数据块应是第一个数据块</p>
<table>
<thead>
<tr>
<th>长度</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td>4字节</td>
<td>图像宽度</td>
</tr>
<tr>
<td>4字节</td>
<td>图像高度</td>
</tr>
<tr>
<td>1字节</td>
<td>色深</td>
</tr>
<tr>
<td>1字节</td>
<td>颜色类型</td>
</tr>
<tr>
<td>1字节</td>
<td>压缩方法</td>
</tr>
<tr>
<td>1字节</td>
<td>过滤方法</td>
</tr>
<tr>
<td>1字节</td>
<td>隔行扫描法</td>
</tr>
</tbody>
</table>
<h3 id="调色板数据块PLTE"><a href="#调色板数据块PLTE" class="headerlink" title="调色板数据块PLTE"></a>调色板数据块PLTE</h3><h3 id="图像数据块IDAT"><a href="#图像数据块IDAT" class="headerlink" title="图像数据块IDAT"></a>图像数据块IDAT</h3><p>4字节块类型域值：49 44 41 54</p>
<h3 id="图像结束数据块IEND"><a href="#图像结束数据块IEND" class="headerlink" title="图像结束数据块IEND"></a>图像结束数据块IEND</h3><p>必须是最后一个数据块。代表PNG数据流的结束。Chunk Data域为空。<br>4字节的块类型域值为： 49 45 4E 44</p>
<h2 id="辅助数据块"><a href="#辅助数据块" class="headerlink" title="辅助数据块"></a>辅助数据块</h2><h3 id="透明度"><a href="#透明度" class="headerlink" title="透明度"></a>透明度</h3><ul>
<li>tRNS<h3 id="颜色空间"><a href="#颜色空间" class="headerlink" title="颜色空间"></a>颜色空间</h3></li>
<li>gAMA</li>
<li>cHRM</li>
<li>sRGB</li>
<li>iCCP<h3 id="文本信息"><a href="#文本信息" class="headerlink" title="文本信息"></a>文本信息</h3></li>
<li>tEXt</li>
<li>zTXt</li>
<li>iTXt<h3 id="其他信息"><a href="#其他信息" class="headerlink" title="其他信息"></a>其他信息</h3></li>
<li>bKGD 背景颜色</li>
<li>pHYs 物理像素尺寸</li>
<li>sBIT</li>
<li>sPLT</li>
<li>hIST</li>
<li>tIME</li>
</ul>
<h2 id="PNG图像分析工具"><a href="#PNG图像分析工具" class="headerlink" title="PNG图像分析工具"></a>PNG图像分析工具</h2><ul>
<li><a href="http://entropymine.com/jason/tweakpng/" target="_blank" rel="external">TweakPNG</a></li>
<li>010 Editor PNG模板</li>
</ul>
<h2 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h2><ul>
<li><a href="https://www.w3.org/TR/PNG/" target="_blank" rel="external">W3C Portable Network Graphics (PNG) Specification (Second Edition)</a></li>
</ul>
</span>

<footer class="post-footer">

<a class="post-tag-link" href="/tags/CTF/">#CTF</a>

<a class="post-tag-link" href="/tags/misc/">#misc</a>



<div class="post-nav">
	<div class="post-nav-prev post-nav-item">
	
		<a rel="prev" href="/2016/09/20/CentOS-7搭建NodeBB论坛/">CentOS 7搭建NodeBB论坛</a>
	
    </div>
    <div class="post-nav-next post-nav-item">
    
    	<a rel="next" href="/2016/09/19/Linux下硬盘备份与恢复/">Linux下硬盘备份与恢复</a>
    
    </div>
</div>

</footer>
</article>


    <div class="post-spread">
      
    </div>
  </div>

</section>
</main>
<footer class="footer" id="footer">
<div class="copyright">
<i class="fa fa-copyright">2015-2017</i>
</div>
</footer>
</div>



</body>
</html>