<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<link rel="stylesheet" type="text/css" href="/css/main.css?v="/>
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css" rel="stylesheet">
<title> Docker基础(第二篇) | 时针它不停在转动 </title>
</head>
<body>
<div id="">
<header id="header" class="header"><div class="header_wrapper">
<h1 class="title">
<a href="/">时针它不停在转动</a>
</h1>

<ul class="nav">


<li>
<a href="/">首页</a>
</li>


<li>
<a href="/archives">归档</a>
</li>


<li>
<a href="/about">关于</a>
</li>

</ul>
</div>
</header>
<main id="main" class="main">
<section id="content" class="content ">

  <div id="posts" class="posts-expand">
    
<article class="post">
<header class="post-header">
<h1 class="post-title">

Docker基础(第二篇)
</a>

</h1>
<div class="post-meta">
<span class="post-time">2015-12-06</span>
<span class="post-category">

&nbsp; | &nbsp;
<a class="post-cat-link" href="/categories/Docker/">
Docker
</a>

&nbsp; | &nbsp;
<a class="post-cat-link" href="/categories/Docker/虚拟化/">
虚拟化
</a>

</span>
</div>
</header>

<span class="articleBody"><h1 id="我的环境"><a href="#我的环境" class="headerlink" title="我的环境"></a>我的环境</h1><p>目前Docker支持大部分的主流平台，如Ubuntu、Cent OS、Windows、Mac OS等。由于我习惯使用CentOS 7,所以本次实验环境是基于Cent OS 7 64位。<br><em>特别说明：</em>刚安装好的系统，使用前，建议执行<strong>yum -y update</strong>命令，对系统进行更新。</p>
<h1 id="安装Docker"><a href="#安装Docker" class="headerlink" title="安装Docker"></a>安装Docker</h1><p>CentOS 7中，源中已经内置Docker，可以直接使用yum安装。<br><figure class="highlight cmake"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yum -y <span class="keyword">install</span> docker</div></pre></td></tr></table></figure></p>
<p>安装成功后，启动并加入开机自动启动。<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">systemctl <span class="keyword">start</span> docker</div><div class="line">systemctl <span class="keyword">enable</span> docker</div></pre></td></tr></table></figure></p>
<p><strong>走过的坑</strong><br>在虚拟机安装之前，同时也在阿里云中centOS 7中尝试安装，遇到Docker无法启动问题，原因在于，Docker运行时需要创建虚拟网卡（就像Vmware中有VMnet1、VMnet8一样），但是默认情况下，阿里云已经占用了私有IP地址段，故需要删除。<br><figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="selector-tag">route</span> <span class="selector-tag">del</span> <span class="selector-tag">-net</span> 172<span class="selector-class">.16</span><span class="selector-class">.0</span><span class="selector-class">.0</span> <span class="selector-tag">netmask</span> 255<span class="selector-class">.240</span><span class="selector-class">.0</span><span class="selector-class">.0</span></div></pre></td></tr></table></figure></p>
<p>这样，就可以正常启动Docker。查看网卡信息如下：<br><figure class="highlight pf"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]<span class="comment"># ip a</span></div><div class="line"><span class="number">1</span>: lo: <span class="variable">&lt;LOOPBACK,UP,LOWER_UP&gt;</span> mtu <span class="number">65536</span> qdisc noqueue <span class="keyword">state</span> UNKNOWN</div><div class="line">    ....</div><div class="line"><span class="number">4</span>: docker0: <span class="variable">&lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt;</span> mtu <span class="number">1500</span> qdisc noqueue <span class="keyword">state</span> UP</div><div class="line">    link/ether <span class="number">02</span>:<span class="number">42</span>:a2:<span class="number">21</span>:be:fa brd ff:ff:ff:ff:ff:ff</div><div class="line">    <span class="keyword">inet</span> <span class="number">172.17</span>.<span class="number">42.1</span>/<span class="number">16</span> scope <span class="keyword">global</span> docker0</div><div class="line">       valid_lft forever preferred_lft forever</div><div class="line">    <span class="keyword">inet6</span> fe80::<span class="number">42</span>:a2ff:fe21:befa/<span class="number">64</span> scope link</div><div class="line">       valid_lft forever preferred_lft forever</div></pre></td></tr></table></figure></p>
<p>多了一个docker0网卡，且ip段为172.17.0.0。</p>
<h1 id="下载镜像"><a href="#下载镜像" class="headerlink" title="下载镜像"></a>下载镜像</h1><p>安装完Docker后，需要下载镜像。那什么是镜像呢？简单的来说，就是docker可以启动运行的文件，举个例子，就像我们安装好虚拟机的文件，拷贝给别人在别人的虚拟机中也能打开。<br>镜像在哪里，如何获取？镜像放置在一个镜像库中，默认镜像库是Docker Hub，这个镜像库是Docker公司负责维护的公共仓库，当然也可以选择其他镜像仓库，如公司的私有仓库、国内维护的仓库dockerpool。<br><strong>下载镜像</strong><br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="number">1</span>、docker pull ubuntu</div><div class="line"><span class="number">2</span>、docker pull ubuntu:<span class="number">14.04</span></div><div class="line"><span class="number">3</span>、docker pull <span class="selector-tag">dl</span><span class="selector-class">.dockerpool</span><span class="selector-class">.com</span>:<span class="number">5000</span>/ubuntu:<span class="number">14.04</span></div></pre></td></tr></table></figure></p>
<p>其中14.04是镜像的标签，如果忽略，默认为latelast。<br><strong>走过的坑</strong><br>由于Docker版本升级，当从非官方源下载时，为了安全起见，需要进行手工认证下载源的安全性。<br>在CentOS 7中，Docker的配置文件<strong>/etc/sysconfig/docker</strong>，<br>在<strong>INSECURE_REGISTRY</strong>处修改，添加自己的源，并去掉注释。如：<br><figure class="highlight ini"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="attr">INSECURE_REGISTRY</span>=<span class="string">'--insecure-registry dl.dockerpool.com:5000'</span></div></pre></td></tr></table></figure></p>
<p>重新启动docker服务，便可以在非官方源下载了。<br><figure class="highlight smali"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">systemctl restart docker<span class="keyword"></span></div><div class="line">systemctl stop docker<span class="keyword"></span></div><div class="line">systemctl start docker<span class="keyword"></span></div><div class="line">systemctl status docker</div></pre></td></tr></table></figure></p>
<h1 id="容器新建、启动、终止"><a href="#容器新建、启动、终止" class="headerlink" title="容器新建、启动、终止"></a>容器新建、启动、终止</h1><p>下载好镜像只有，可以查看本地的镜像。<br><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]<span class="comment"># docker images</span></div><div class="line">REPOSITORY                      <span class="keyword">TAG</span>                 <span class="title">IMAGE</span> ID            CREATED             VIRTUAL SIZE</div><div class="line">dl.dockerpool.com:<span class="number">5000</span>/ubuntu   <span class="number">14.04</span>               <span class="number">5506</span>de2b643b        <span class="number">13</span> months ago       <span class="number">199.2</span> MB</div><div class="line">dl.dockerpool.com:<span class="number">5000</span>/ubuntu   latest              <span class="number">0</span>b310e6bf058        <span class="number">13</span> months ago       <span class="number">126.6</span> MB</div></pre></td></tr></table></figure></p>
<p>指定镜像，创建容器。容器我们可以简单的认为是我们通过虚拟机文件启动的一台虚拟机。<br><figure class="highlight less"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="selector-attr">[root@localhost ~]</span># <span class="selector-tag">docker</span> <span class="selector-tag">create</span> <span class="selector-tag">-it</span> <span class="selector-tag">dl</span><span class="selector-class">.dockerpool</span><span class="selector-class">.com</span><span class="selector-pseudo">:5000</span>/<span class="selector-tag">ubuntu</span><span class="selector-pseudo">:14.04</span></div><div class="line"><span class="selector-tag">130b9ee0454e81b3fa62deec189c33b5be295035dbeda9f2ad93578e385e1993</span></div></pre></td></tr></table></figure></p>
<p>其中我们需要指定完整的镜像名称以及标签。<br>创建好的容器并不会运行，而是处于停止状态。<br><figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]<span class="comment"># docker ps -a</span></div><div class="line">CONTAINER ID        IMAGE                                 COMMAND             CREATED              STATUS                   PORTS               NAMES</div><div class="line"><span class="number">130</span>b9ee0454e        dl.dockerpool.com:<span class="number">5000</span>/ubuntu:<span class="number">14.04</span>   <span class="string">"/bin/bash"</span>         About a minute ago   Created                                      evil_bohr</div></pre></td></tr></table></figure></p>
<p>启动指定容器,需要指定容器ID，当然可以简写，只要可以唯一识别即可。<br><figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]<span class="comment"># docker start 130</span></div><div class="line"><span class="number">130</span></div><div class="line">[root@localhost ~]<span class="comment"># docker ps -a</span></div><div class="line">CONTAINER ID        IMAGE                                 COMMAND             CREATED             STATUS                   PORTS               NAMES</div><div class="line"><span class="number">130</span>b9ee0454e        dl.dockerpool.com:<span class="number">5000</span>/ubuntu:<span class="number">14.04</span>   <span class="string">"/bin/bash"</span>         <span class="number">3</span> minutes ago       Up <span class="number">6</span> seconds                                 evil_bohr</div></pre></td></tr></table></figure></p>
<p>终止指定容器<br><figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]<span class="comment"># docker stop 130</span></div><div class="line"><span class="number">130</span></div><div class="line">[root@localhost ~]<span class="comment"># docker ps -a</span></div><div class="line">CONTAINER ID        IMAGE                                 COMMAND             CREATED             STATUS                     PORTS               NAMES</div><div class="line"><span class="number">130</span>b9ee0454e        dl.dockerpool.com:<span class="number">5000</span>/ubuntu:<span class="number">14.04</span>   <span class="string">"/bin/bash"</span>         <span class="number">5</span> minutes ago       Exited (<span class="number">0</span>) <span class="number">6</span> seconds ago                       evil_bohr</div></pre></td></tr></table></figure></p>
<p>除了这几种最基础的操作以外，还有许多操作需要我学习，我也会不断学习，不断总结。</p>
</span>

<footer class="post-footer">

<a class="post-tag-link" href="/tags/Docker/">#Docker</a>



<div class="post-nav">
	<div class="post-nav-prev post-nav-item">
	
		<a rel="prev" href="/2015/12/07/内网端口转发/">内网端口转发</a>
	
    </div>
    <div class="post-nav-next post-nav-item">
    
    	<a rel="next" href="/2015/12/06/Docker基础-第一篇/">Docker基础(一)</a>
    
    </div>
</div>

</footer>
</article>


    <div class="post-spread">
      
    </div>
  </div>

</section>
</main>
<footer class="footer" id="footer">
<div class="copyright">
<i class="fa fa-copyright">2015-2017</i>
</div>
</footer>
</div>



</body>
</html>