<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<link rel="stylesheet" type="text/css" href="/css/main.css?v="/>
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css" rel="stylesheet">
<title> Linux下硬盘备份与恢复 | 时针它不停在转动 </title>
</head>
<body>
<div id="">
<header id="header" class="header"><div class="header_wrapper">
<h1 class="title">
<a href="/">时针它不停在转动</a>
</h1>

<ul class="nav">


<li>
<a href="/">首页</a>
</li>


<li>
<a href="/categories">分类</a>
</li>


<li>
<a href="/archives">归档</a>
</li>


<li>
<a href="/about">关于</a>
</li>

</ul>
</div>
</header>
<main id="main" class="main">
<section id="content" class="content">

  <div id="posts" class="posts-expand">
    
<article class="post">
<header class="post-header">
<h1 class="post-title">

Linux下硬盘备份与恢复
</a>

</h1>
<div class="post-meta">
<span class="post-time">2016-09-19</span>
<span class="post-category">

&nbsp; | &nbsp;
<a class="post-cat-link" href="/categories/Linux/">
Linux
</a>

</span>
</div>
</header>

<span class="articleBody"><h3 id="硬盘分区"><a href="#硬盘分区" class="headerlink" title="硬盘分区"></a>硬盘分区</h3><p>使用<code>fdisk -l</code>查看硬盘分区情况<br><figure class="highlight tap"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">root@kali:/tmp<span class="comment"># fdisk -l</span></div><div class="line"></div><div class="line">//共有两块硬盘 /dev/sdb /dev/sda</div><div class="line">Disk /dev/sdb:<span class="number"> 1 </span>GiB,<span class="number"> 1073741824 </span>bytes,<span class="number"> 2097152 </span>sectors</div><div class="line">Units: sectors of<span class="number"> 1 </span>*<span class="number"> 512 </span>=<span class="number"> 512 </span>bytes</div><div class="line">Sector size (logical/physical):<span class="number"> 512 </span>bytes /<span class="number"> 512 </span>bytes</div><div class="line">I/O size (minimum/optimal):<span class="number"> 512 </span>bytes /<span class="number"> 512 </span>bytes</div><div class="line">Disklabel type: dos</div><div class="line">Disk identifier: 0x293a4722</div><div class="line"></div><div class="line">Device     Boot Start   End Sectors Size Id Type</div><div class="line">/dev/sdb1       <span class="number"> 2048 </span><span class="number"> 6143 </span>  <span class="number"> 4096 </span>  2M<span class="number"> 83 </span>Linux</div><div class="line"></div><div class="line">Disk /dev/sda:<span class="number"> 30 </span>GiB,<span class="number"> 32212254720 </span>bytes,<span class="number"> 62914560 </span>sectors</div><div class="line">Units: sectors of<span class="number"> 1 </span>*<span class="number"> 512 </span>=<span class="number"> 512 </span>bytes</div><div class="line">Sector size (logical/physical):<span class="number"> 512 </span>bytes /<span class="number"> 512 </span>bytes</div><div class="line">I/O size (minimum/optimal):<span class="number"> 512 </span>bytes /<span class="number"> 512 </span>bytes</div><div class="line">Disklabel type: dos</div><div class="line">Disk identifier: 0xb2d1b90f</div><div class="line"></div><div class="line">Device     Boot    Start      End  Sectors  Size Id Type</div><div class="line">/dev/sda1  *       <span class="number"> 2048 </span>60262399<span class="number"> 60260352 </span>28.8G<span class="number"> 83 </span>Linux</div><div class="line">/dev/sda2      <span class="number"> 60264446 </span>62912511 <span class="number"> 2648066 </span> 1.3G <span class="number"> 5 </span>Extended</div><div class="line">/dev/sda5      <span class="number"> 60264448 </span>62912511 <span class="number"> 2648064 </span> 1.3G<span class="number"> 82 </span>Linux swap / Solaris</div></pre></td></tr></table></figure></p>
<p>在Linux下，IDE硬盘设备名为hd*(a-d)，SCSI、SATA、USB硬盘设备名为sd*(a-z)。<br>硬盘主分区最多4个，故主分区从sda1-sda4，扩展分区最多一个，且主分区加扩展分区最多为4个，逻辑分区从sda5开始。</p>
<p>现在我们为设备sdb新建主分区sdb2，大小位10M。</p>
<figure class="highlight oxygene"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div></pre></td><td class="code"><pre><div class="line">root@kali:/tmp# fdisk /dev/sdb</div><div class="line"></div><div class="line">Welcome <span class="keyword">to</span> fdisk (util-linux <span class="number">2.25</span>.<span class="number">2</span>).</div><div class="line">Changes will remain <span class="keyword">in</span> memory only, <span class="keyword">until</span> you decide <span class="keyword">to</span> <span class="keyword">write</span> them.</div><div class="line">Be careful before <span class="keyword">using</span> the <span class="keyword">write</span> command.</div><div class="line"></div><div class="line"><span class="comment">//n添加分区</span></div><div class="line">Command (m <span class="keyword">for</span> help): n</div><div class="line">Partition <span class="keyword">type</span></div><div class="line">   p   primary (<span class="number">1</span> primary, <span class="number">0</span> extended, <span class="number">3</span> free) <span class="comment">//提示已经存在1个主分区，0个扩展分区，还可以添加3个</span></div><div class="line">   e   extended (container <span class="keyword">for</span> logical partitions) <span class="comment">//扩展分区 逻辑分区的容器</span></div><div class="line"><span class="comment">//p 为主分区</span></div><div class="line"><span class="keyword">Select</span> (<span class="keyword">default</span> p): p <span class="comment">//主分区</span></div><div class="line">Partition number (<span class="number">2</span>-<span class="number">4</span>, <span class="keyword">default</span> <span class="number">2</span>): <span class="comment">//分区编号 默认为2</span></div><div class="line">First sector (<span class="number">6144</span>-<span class="number">2097151</span>, <span class="keyword">default</span> <span class="number">6144</span>): <span class="comment">//起始柱面编号</span></div><div class="line">Last sector, +sectors <span class="keyword">or</span> +size<span class="comment">&#123;K,M,G,T,P&#125;</span> (<span class="number">6144</span>-<span class="number">2097151</span>, <span class="keyword">default</span> <span class="number">2097151</span>): +<span class="number">10</span>M <span class="comment">//结束柱面 可以以大小确定</span></div><div class="line"></div><div class="line">Created a <span class="keyword">new</span> partition <span class="number">2</span> <span class="keyword">of</span> <span class="keyword">type</span> <span class="string">'Linux'</span> <span class="keyword">and</span> <span class="keyword">of</span> size <span class="number">10</span> MiB.</div><div class="line"></div><div class="line">Command (m <span class="keyword">for</span> help): p <span class="comment">//显示分区列表</span></div><div class="line">Disk /dev/sdb: <span class="number">1</span> GiB, <span class="number">1073741824</span> bytes, <span class="number">2097152</span> sectors</div><div class="line">Units: sectors <span class="keyword">of</span> <span class="number">1</span> * <span class="number">512</span> = <span class="number">512</span> bytes</div><div class="line">Sector size (logical/physical): <span class="number">512</span> bytes / <span class="number">512</span> bytes</div><div class="line">I/O size (minimum/optimal): <span class="number">512</span> bytes / <span class="number">512</span> bytes</div><div class="line">Disklabel <span class="keyword">type</span>: dos</div><div class="line">Disk identifier: <span class="number">0</span>x293a4722</div><div class="line"></div><div class="line">Device     Boot Start   <span class="keyword">End</span> Sectors Size Id <span class="keyword">Type</span></div><div class="line">/dev/sdb1        <span class="number">2048</span>  <span class="number">6143</span>    <span class="number">4096</span>   <span class="number">2</span>M <span class="number">83</span> Linux</div><div class="line">/dev/sdb2        <span class="number">6144</span> <span class="number">26623</span>   <span class="number">20480</span>  <span class="number">10</span>M <span class="number">83</span> Linux</div><div class="line"></div><div class="line"></div><div class="line">Command (m <span class="keyword">for</span> help): w <span class="comment">//保存 不保存不生效</span></div><div class="line">The partition table <span class="keyword">has</span> been altered.</div><div class="line">Calling ioctl() <span class="keyword">to</span> re-<span class="keyword">read</span> partition table.</div><div class="line">Syncing disks.</div><div class="line"></div><div class="line"><span class="comment">//使用fdisk -l查看 添加分区完成</span></div><div class="line">....</div><div class="line">Device     Boot Start   <span class="keyword">End</span> Sectors Size Id <span class="keyword">Type</span></div><div class="line">/dev/sdb1        <span class="number">2048</span>  <span class="number">6143</span>    <span class="number">4096</span>   <span class="number">2</span>M <span class="number">83</span> Linux</div><div class="line">/dev/sdb2        <span class="number">6144</span> <span class="number">26623</span>   <span class="number">20480</span>  <span class="number">10</span>M <span class="number">83</span> Linux</div><div class="line">....</div></pre></td></tr></table></figure>
<h3 id="硬盘格式化"><a href="#硬盘格式化" class="headerlink" title="硬盘格式化"></a>硬盘格式化</h3><p>添加完毕分区后，必须格式化才能使用<br><figure class="highlight fsharp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">root@kali:/tmp# mkfs -t ext3 /dev/sdb2 <span class="comment">//-t 指定文件系统类型</span></div><div class="line">mke2fs <span class="number">1.42</span><span class="number">.12</span> (<span class="number">29</span>-Aug<span class="number">-2014</span>)</div><div class="line">Creating filesystem <span class="keyword">with</span> <span class="number">10240</span> <span class="number">1</span>k blocks <span class="keyword">and</span> <span class="number">2560</span> inodes</div><div class="line">Filesystem UUID: <span class="number">330</span>d0106-a723<span class="number">-4</span>bae<span class="number">-8</span>a00-d5d8105d4a0d</div><div class="line">Superblock backups stored on blocks: </div><div class="line">	<span class="number">8193</span></div><div class="line"></div><div class="line">Allocating group tables: <span class="keyword">done</span>                            </div><div class="line">Writing inode tables: <span class="keyword">done</span>                            </div><div class="line">Creating journal (<span class="number">1024</span> blocks): <span class="keyword">done</span></div><div class="line">Writing superblocks <span class="keyword">and</span> filesystem accounting information: <span class="keyword">done</span></div></pre></td></tr></table></figure></p>
<h3 id="挂载"><a href="#挂载" class="headerlink" title="挂载"></a>挂载</h3><p>格式化后的硬盘需要挂载，在生产环境下，需要设置为开机自动挂载，这里我们只做单次挂载。</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">root<span class="variable">@kali</span><span class="symbol">:/tmp</span><span class="comment"># mkdir test3 //创建挂载点</span></div><div class="line">root<span class="variable">@kali</span><span class="symbol">:/tmp</span><span class="comment"># mount /dev/sdb2 test3 //挂载</span></div><div class="line">root<span class="variable">@kali</span><span class="symbol">:/tmp</span><span class="comment"># cd test3</span></div><div class="line">root<span class="variable">@kali</span><span class="symbol">:/tmp/test3</span><span class="comment"># ls</span></div><div class="line">lost+found</div></pre></td></tr></table></figure>
<h3 id="备份指定分区"><a href="#备份指定分区" class="headerlink" title="备份指定分区"></a>备份指定分区</h3><p>挂载好之后，我们就可以在挂载目录下使用了。为了方便起见，我们在该分区创建若干文件，然后备份该分区。</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">root<span class="variable">@kali</span><span class="symbol">:/tmp/test3</span><span class="comment"># ls</span></div><div class="line">abc  abd  abe  lost+found</div><div class="line">root<span class="variable">@kali</span><span class="symbol">:/tmp/test3</span><span class="comment"># cd ..</span></div><div class="line">root<span class="variable">@kali</span><span class="symbol">:/tmp</span><span class="comment"># umount /tmp/test3 //卸载硬盘</span></div><div class="line">root<span class="variable">@kali</span><span class="symbol">:/tmp</span><span class="comment"># dd if=/dev/sdb2 of=disk-image1 //使用dd备份分区，当然可以备份整个硬盘</span></div><div class="line"><span class="number">20480</span>+<span class="number">0</span> records <span class="keyword">in</span></div><div class="line"><span class="number">20480</span>+<span class="number">0</span> records out</div><div class="line"><span class="number">10485760</span> bytes (<span class="number">10</span> MB) copied, <span class="number">0</span>.<span class="number">289164</span> s, <span class="number">36.3</span> MB/s</div></pre></td></tr></table></figure>
<h3 id="挂载硬盘镜像"><a href="#挂载硬盘镜像" class="headerlink" title="挂载硬盘镜像"></a>挂载硬盘镜像</h3><figure class="highlight elixir"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">root<span class="variable">@kali</span><span class="symbol">:/tmp</span><span class="comment"># binwalk disk-image1 //通过binwalk可以看到文件</span></div><div class="line"></div><div class="line">DECIMAL       HEXADECIMAL     DESCRIPTION</div><div class="line">--------------------------------------------------------------------------------</div><div class="line"><span class="number">0</span>             <span class="number">0x0</span>             Linux EXT filesystem, rev <span class="number">1.0</span> ext3 filesystem data, UUID=<span class="number">330</span>d0106-a723-<span class="number">4</span>bae-<span class="number">8</span>a0<span class="number">0</span>-d5d8105d105d</div><div class="line"><span class="number">224256</span>        <span class="number">0x36C00</span>         Linux EXT filesystem, rev <span class="number">1.0</span> ext3 filesystem data, UUID=<span class="number">330</span>d0106-a723-<span class="number">4</span>bae-<span class="number">8</span>a0<span class="number">0</span>-d5d8105d105d</div><div class="line"><span class="number">2098176</span>       <span class="number">0x200400</span>        PNG image, <span class="number">164</span> x <span class="number">371</span>, <span class="number">8</span>-bit/color RGB, non-interlaced</div><div class="line"><span class="number">2098256</span>       <span class="number">0x200450</span>        Zlib compressed data, default compression, uncompressed size &gt;= <span class="number">65536</span></div><div class="line"><span class="number">8388608</span>       <span class="number">0x800000</span>        Linux EXT filesystem, rev <span class="number">1.0</span> ext3 filesystem data, UUID=<span class="number">330</span>d0106-a723-<span class="number">4</span>bae-<span class="number">8</span>a0<span class="number">0</span>-d5d8105d105d</div><div class="line"></div><div class="line">root<span class="variable">@kali</span><span class="symbol">:/tmp</span><span class="comment"># file disk-image1 //查看文件类型</span></div><div class="line">disk-<span class="symbol">image1:</span> Linux rev <span class="number">1.0</span> ext3 filesystem data, UUID=<span class="number">330</span>d0106-a723-<span class="number">4</span>bae-<span class="number">8</span>a0<span class="number">0</span>-d5d8105d4a0d</div><div class="line"></div><div class="line">root<span class="variable">@kali</span><span class="symbol">:/tmp</span><span class="comment"># mount disk-image1 test4</span></div><div class="line"><span class="symbol">mount:</span> mount point test4 does <span class="keyword">not</span> exist</div><div class="line">root<span class="variable">@kali</span><span class="symbol">:/tmp</span><span class="comment"># mkdir test4</span></div><div class="line">root<span class="variable">@kali</span><span class="symbol">:/tmp</span><span class="comment"># mount disk-image1 test4</span></div><div class="line">root<span class="variable">@kali</span><span class="symbol">:/tmp</span><span class="comment"># cd test4</span></div><div class="line">root<span class="variable">@kali</span><span class="symbol">:/tmp/test4</span><span class="comment"># ls  //显示正常的文件</span></div><div class="line">abc  abd  abe  lost+found  test.png</div></pre></td></tr></table></figure></span>

<footer class="post-footer">

<a class="post-tag-link" href="/tags/Linux/">#Linux</a>

<a class="post-tag-link" href="/tags/取证/">#取证</a>

<a class="post-tag-link" href="/tags/备份/">#备份</a>



<div class="post-nav">
	<div class="post-nav-prev post-nav-item">
	
		<a rel="prev" href="/2016/09/20/png图片结构分析/">png图片结构分析</a>
	
    </div>
    <div class="post-nav-next post-nav-item">
    
    	<a rel="next" href="/2016/01/01/基于错误的SQL注入/">基于错误的SQL注入</a>
    
    </div>
</div>

</footer>
</article>


    <div class="post-spread">
      
    </div>
  </div>

</section>
</main>
<footer class="footer" id="footer">
<div class="copyright">
<i class="fa fa-copyright">2015-2017</i>
</div>
</footer>
</div>



</body>
</html>